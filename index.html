<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Admin PT Bangga Karya</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; }
        .header { background: white; padding: 20px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .btn-status { padding: 10px 20px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }
        .on { background: #28a745; color: white; }
        .off { background: #dc3545; color: white; }
        table { width: 100%; background: white; border-collapse: collapse; border-radius: 12px; overflow: hidden; }
        th { background: #fe2c55; color: white; padding: 15px; text-align: left; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        button { padding: 8px; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: bold; }
        .btn-p { background: #ffc107; }
        .btn-b { background: #00f2ea; }
        .btn-g { background: #666; color: white; }
        .btn-del { background: #ff4d4d; color: white; float: right; }
    </style>
</head>
<body>

<div class="header">
    <div>
        <h2 style="margin:0">Admin Panel Likes</h2>
        <span>PT Bangga Karya Indonesia</span>
    </div>
    <div>
        <button class="btn-status on" onclick="setStatus('ON')">SISTEM ON</button>
        <button class="btn-status off" onclick="setStatus('OFF')">SISTEM OFF</button>
    </div>
</div>

<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Link Video</th>
            <th>Status</th>
            <th>Aksi Admin</th>
        </tr>
    </thead>
    <tbody id="adminTable"></tbody>
</table>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCTvPUfC1xSlup78dtXfs0AFogOUheAi-E",
        authDomain: "tikfoll.firebaseapp.com",
        projectId: "tikfoll",
        databaseURL: "https://tikfoll-default-rtdb.asia-southeast1.firebasedatabase.app/",
        storageBucket: "tikfoll.firebasestorage.app",
        messagingSenderId: "210219887620",
        appId: "1:210219887620:web:ad7c29c37ff0f74f3ed951"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function setStatus(s) { db.ref('system_status').set(s); }

    db.ref('orders').on('value', (snapshot) => {
        const tbody = document.getElementById('adminTable');
        tbody.innerHTML = '';
        let items = [];
        snapshot.forEach(c => { items.push({id: c.key, ...c.val()}); });
        items.sort((a,b) => b.time - a.time);

        items.forEach(val => {
            tbody.innerHTML += `
                <tr>
                    <td>${val.id}</td>
                    <td><a href="${val.link}" target="_blank">Lihat Video</a></td>
                    <td><b>${val.status}</b></td>
                    <td>
                        <button class="btn-p" onclick="upd('${val.id}', 'Dalam Proses')">PROSES</button>
                        <button class="btn-b" onclick="upd('${val.id}', 'Berhasil')">BERHASIL</button>
                        <button class="btn-g" onclick="upd('${val.id}', 'Gagal')">GAGAL</button>
                        <button class="btn-del" onclick="hapus('${val.id}')">HAPUS</button>
                    </td>
                </tr>
            `;
        });
    });

    function upd(id, s) { db.ref('orders/' + id).update({ status: s }); }
    function hapus(id) { if(confirm('Hapus data?')) db.ref('orders/' + id).remove(); }
</script>
</body>
</html>
